{% extends "admin/bluebase.html" %}
{% import "admin/macros.html" as m %}

{% block headers %}
{{super()}}
<script>
$(document).ready(function(){
	$('.deleterow').click(function() { $(this).closest('tr').remove(); return false; });
	$('#classlistform .addbutton').click(function() {
        newCountedRow('#classlistform');
        return false;
    });
});
</script>
{% endblock headers %}

{% macro dorow(ii, field) %}
<tr data-counter="{{ii}}">
<td>{{field['classcode']}}</td>
<td>{{field['descrip']}}</td>
<td>{{field['eventtrophy']}}</td>
<td>{{field['champtrophy']}}</td>
<td>{{field['carindexed']}}</td>
<td>{{field['secondruns']}}</td>
<td class='clsindexcol'>{{field['indexcode']}}</td>
<td class='multcol'>{{field['classmultiplier']}}</td>
<td class='flagcol'>{{field['usecarflag']}}</td>
<td>{{field['caridxrestrict']}}</td>
<td class='limitcol'>{{field['countedruns']}}</td>
<td><button class="btn btn-outline-admin small deleterow">Del</button></td>
<td></td>
</tr>
{% endmacro %}


{% block content %}
{{super()}}

<div class='container-fluid'>
<h2>Class Editor</h2>

<p>
Each class has a short code and a full string description.  The description is optional.  The settings available are:

<table class='doctable'>
<tr><th>Event Trophy</th><td>This class is eligible for trophies at each event and will have a 'T' added in the results</td></tr>
<tr><th>Champ Trophy</th><td>This class is eligible for championship points and will appear in the championship report</td></tr>
<tr><th>Cars Indexed</th><td>Cars in this class will have an index applied based on the index of the car entry</td></tr>
<tr><th>Class Indexed</th><td>All cars in this class will have an index applied based on this specified index code</td></tr>
<tr><th>Addl Multiplier</th><td>All cars in this class will have an additional multipler applied to them, like class indexed but statically assigned to this class.  This is a place for a street tire modifier.</td></tr>
<tr><th>Require Car Flag</th><td>If checked, cars in this class will have their own checkbox for additional tire index and only if that is checked will additional multiplier be applied.</td></tr>
<tr><th>Index Restrict</th><td>This will limit the index selection given to the user based on the <a href='restricthelp' target='helptab'>provided value</a></td></tr>
<tr><th>Counted Runs</th><td>Entries in the class will only count a maximum of X runs towards official results.  If all classes are to have the same number of counted runs, you can also set counted runs for each event.  The minimum of the two is used.</td></tr>
</table>

</p>

<form action="{{url_for(".classlist")}}" method="post" id='classlistform'>
<table class='classtable'>
<tr>
<th>Code</th>
<th>Description</th>
<th>Event<br/>Trophy</th>
<th>Champ<br/>Trophy</th>
<th>Cars<br/>Indexed</th>
<th>Second<br/>Runs</th>
<th>Class<br/>Indexed</th>
<th class='multcol'>Addl<br/>Multiplier</th>
<th class='flagcol'>Require<br/>Car Flag</th>
<th>Index<br/>Restrict</th>
<th>Counted<br/>Runs</th>
</tr>

{% for field in form.classlist %}
{{dorow(loop.index0, field)}}
{% endfor %}

</table>
{{form.csrf_token()}}
<button class='btn btn-outline-admin addbutton'>Add Row</button>
<input  class='btn btn-admin' type='submit' value="Save">
</form>

</div>

{% endblock content %}

