{% extends "results/bluebase.html" %}

{% block headers %}
{{super()}}
<style type="text/css">
/* Override a few things just for the popup display */
#popup {
	display:none;
	position: absolute; 
	background: white; 
	font-size: 0.8em;
	border: 1px ridge #999999;
}
table.challengeround { margin: 0px; width: auto; }
table.challengeround td.entrant { width: auto; }

#bracket {
    display:flex;
    flex-direction:row;
}

.round {
    font-size: 0.8rem;
    display:flex;
    flex-direction:column;
    justify-content:center;
    width:12rem;
    list-style:none;
    padding:0;
}

.round .spacer {
    flex-grow: .5; 
}

.round .runoff.spacer {
    flex-grow: 1.25;
}

li.runoff {
    padding-left: 7px;
}

li.runoff.winner {
    font-weight: bold;
}

li.runoff span.dial {
    float: right;
    margin-right: 5px;
}

li.runoff span.rank {
    display: none;
}

ul.round-0 span.rank {
    display: inline;
}

li.runoff.top {
    border-bottom:1px solid #aaa;
}

li.runoff.spacer {  
    border-right: 1px solid #aaa;
    min-height: 3rem;
}

li.runoff.bottom { 
    border-top: 1px solid #aaa;
}

</style>

<script type="text/javascript">
function mousein(ev, rnd)
{	
	pop = document.getElementById("popup");
	pop.style.left = (ev.clientX-10)+"px";
	pop.style.top = (ev.clientY-10)+"px";
	pop.style.display = 'block';
	pop.innerHTML = "<h4>loading round data...</h4>";
	$('#popup').load('{{url_for('.bracketround', challengeid=g.challengeid, round=999)}}'.replace('999', rnd));
}
</script>
{% endblock headers %}

{% block content %}
{{super()}}
<div class='container'>
<div id='popup' onclick='style.display="none";'></div>

<h3>{{challenge.name}}</h3>
<div id="bracket">
    {% set rnd = (challenge.baserounds*2) - 1 %}
    {% for d1 in range(challenge.depth) %}
        <ul class="round round-{{d1}}">
        {% set rounds = (challenge.baserounds/(2**d1))|int %}
        {% for d2 in range(rounds) %}
            {% set rndnum = rounds*2 - d2 - 1 %}
            {% set rnd = results[rndnum] %}
		    <li class="spacer">&nbsp;</li>
		    <li class="runoff top {{rnd.winner==1 and 'winner' or ''}}"    onclick="mousein(event, {{rndnum}})">
                <span class='rank'>{{ ranks[rndnum*2+1]}}</span> {{ rnd.e1.firstname }} {{ rnd.e1.lastname }} <span class='dial'>{{ rnd.e1.dial }}</span>
            </li>
		    <li class="runoff spacer" onclick="mousein(event, {{rndnum}})">&nbsp;</li>
            <li class="runoff bottom {{rnd.winner==2 and 'winner' or ''}}" onclick="mousein(event, {{rndnum}})">
                <span class='rank'>{{ ranks[rndnum*2]}}</span> {{ rnd.e2.firstname }} {{ rnd.e2.lastname }} <span class='dial'>{{ rnd.e2.dial }}</span>
            </li>
		    <li class="spacer">&nbsp;</li>
            {% endfor %}
        </ul>
    {% endfor %}
</div>
</div>

{% endblock content %}

