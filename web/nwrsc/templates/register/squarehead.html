<script type="text/javascript" src="https://js.squareup.com/v2/paymentform"></script>
<script>
var applicationId = '{{squareacct.applicationId}}';
var paymentForm = new SqPaymentForm({
  applicationId: applicationId,
  //locationId: locationId,
  inputClass: 'sq-input',
  inputStyles: [ { fontSize: '15px' } ],
  // Used for credit card payments
  cardNumber:     { elementId: 'sq-card-number',     placeholder: '.... .... .... ....' },
  cvv:            { elementId: 'sq-cvv',             placeholder: 'CVV' },
  expirationDate: { elementId: 'sq-expiration-date', placeholder: 'MM/YY' },
  postalCode:     { elementId: 'sq-postal-code' },
  // Payment form callback functions
  callbacks: {
    // Used for credit card payments. Called when the SqPaymentForm
    // completes a request to generate a card nonce, even if the request
    // failed because of an error.
    cardNonceResponseReceived: function(errors, nonce, cardData) {
      if (errors) {
        console.log("Encountered errors:");
        errors.forEach(function(error) { console.log('  ' + error.message); });
        return;
      } else {

        // You can delete this line, it's provided for testing purposes
        alert('Nonce received: ' + nonce);
        // Assign the nonce value to the hidden form field
        document.getElementById('card-nonce').value = nonce;
        document.getElementById('nonce-form').submit();

        // Let the form continue to the payment processing page
        submitPayment(nonce);
      }
    },

    unsupportedBrowserDetected: function() {
        alert('Browser not supported for square payments');
    },

    paymentFormLoaded: function() {
      // Fill in this callback to perform actions after the payment form is
      // done loading (such as setting the postal code field programmatically).
      // paymentForm.setPostalCode('94103');
    }
  }
});

// This function is called when a buyer clicks the Submit button on the webpage to charge their card.
function requestCardNonce(event) {
  event.preventDefault();
  paymentForm.requestCardNonce();
}
</script>

<style type="text/css">
  .sq-input {
    border: 1px solid rgb(223, 223, 223);
    outline-offset: -2px;
    margin-bottom: 5px;
  }
  .sq-input--focus {
    /* Indicates how form inputs should appear when they have focus */
    outline: 5px auto rgb(59, 153, 252);
  }
  .sq-input--error {
    /* Indicates how form inputs should appear when they contain invalid values */
    outline: 5px auto rgb(255, 97, 97);
  }
</style>

